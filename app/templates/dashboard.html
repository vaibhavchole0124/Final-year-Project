<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Analytics Dashboard</title>

    <!-- BOOTSTRAP + ICONS + CHART.JS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="/static/css/style.css">
    

    <style>
        /* ===== DASHBOARD BACKGROUND ===== */
        body {
            background: linear-gradient(180deg,#0f2a45,#0b3550);
            min-height: 100vh;
            color: #ffffff;
        }

        /* ===== NAVBAR SAME AS SINGLE ===== */
        .navbar {
            background: linear-gradient(90deg, #081a33, #0d3b66) !important;
            border-bottom: 1px solid rgba(255,255,255,0.15);
        }

        .navbar-brand {
            color: #ffffff !important;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .navbar .btn {
            border-radius: 20px;
            padding: 4px 14px;
            font-weight: 600;
        }

        .navbar .btn-outline-primary {
            color: #ffffff;
            border-color: rgba(255,255,255,0.4);
        }

        .navbar .btn-outline-primary:hover {
            background: #f6b93b;
            color: #000;
            border-color: #f6b93b;
        }

        .navbar .btn-outline-danger {
            color: #ff6b6b;
            border-color: #ff6b6b;
        }

        .navbar .btn-outline-danger:hover {
            background: #ff6b6b;
            color: #fff;
        }

        /* ===== PAGE TITLE ===== */
        .text-center h2 {
            color: #ffffff;
            font-weight: 700;
        }

        .text-center p {
            color: rgba(255,255,255,0.7);
        }

        /* ===== WHITE CONTENT CARDS ===== */
        .tab-card {
            background: #ffffff;
            color: #000000;
            padding: 20px;
            border-radius: 14px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.25);
        }

        /* ===== SUMMARY BOXES ===== */
        .small-box {
            padding: 20px;
            color: white;
            border-radius: 14px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.25);
        }

        .bg-green { background: #28a745; }
        .bg-red { background: #dc3545; }
        .bg-blue { background: #0d6efd; }
        .bg-orange { background: #fd7e14; }

        /* ===== TABS ===== */
        .nav-tabs {
            border-bottom: none;
        }

        .nav-tabs .nav-link {
            border: none;
            color: #ffffff;
            font-weight: 600;
        }

        .nav-tabs .nav-link.active {
            background: #f6b93b;
            color: #000 !important;
            border-radius: 20px;
        }
        
</style>

</head>

<body>



<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg px-4 py-2 shadow-sm"
     style="background:linear-gradient(180deg,#0f2a45,#0b3550);">


    <a class="navbar-brand fw-bold text-white d-flex align-items-center" href="/">
        <img src="{{ url_for('static', filename='logo.png') }}"
            style="height:40px; margin-right:10px;">
        HR Attrition Dashboard
    </a>


    <div class="ms-auto d-flex gap-2">

    <a href="/" class="btn btn-outline-primary btn-sm">Single</a>
    <a href="/bulk" class="btn btn-outline-primary btn-sm">Bulk</a>
    <a href="/dashboard" class="btn btn-outline-primary btn-sm">Dashboard</a>

    {% if session.get('logged_in') %}
        <a href="{{ url_for('logout') }}" class="btn btn-outline-danger btn-sm">Logout</a>
    {% else %}
        <a href="{{ url_for('login') }}" class="btn btn-primary btn-sm">Login</a>
    {% endif %}

    </div>

</nav>


<div class="container mt-4">

    <div class="text-center mb-4">
        <h2 class="fw-bold">ðŸ“Š Employee Analytics Dashboard</h2>
        <p class="text-white">{{ dataset_name }} | Total Records: {{ total_records }}</p>
    </div>

    <!-- SUMMARY CARDS -->
    <div class="row mb-4">
        <div class="col-lg-3 col-md-6 mb-2">
            <div class="small-box bg-green">
                <h4>{{ stay_pct }}%</h4><p>Employees Staying</p>
            </div>
        </div>

        <div class="col-lg-3 col-md-6 mb-2">
            <div class="small-box bg-red">
                <h4>{{ leave_pct }}%</h4><p>Employees Leaving</p>
            </div>
        </div>

        <div class="col-lg-3 col-md-6 mb-2">
            <div class="small-box bg-blue">
                <h4>{{ models_compared }}</h4><p>Models Compared</p>
            </div>
        </div>

        <div class="col-lg-3 col-md-6 mb-2">
            <div class="small-box bg-orange">
                <h4>{{ best_accuracy }}%</h4><p>Best Model Accuracy</p>
            </div>
        </div>
    </div>


    <!-- TABS -->
    <ul class="nav nav-tabs mb-3" id="dashboardTabs">
        <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#overview">Overview</a></li>
        <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#risk">Risk</a></li>
        <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#models">Model Comparison</a></li>
        <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#featureimportance">Feature Importance</a></li>
        <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#salary">Salary</a></li>
        <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#forecast">Forecast</a></li>
        <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#insights">Insights</a></li>
    </ul>


    <div class="tab-content">

        <!-- OVERVIEW TAB -->
        <div class="tab-pane fade show active" id="overview">
            <div class="tab-card">

                <h4 class="fw-bold mb-3">Overall Attrition</h4>
                <canvas id="overallChart" style="width:700px; height:680px;"></canvas>

                <h4 class="fw-bold mb-4 mt-4">Attrition by Department</h4>
                <canvas id="deptChart" style="width:700px; height:680px;"></canvas>

                <h4 class="fw-bold mb-4 mt-4">Attrition by Job Role</h4>
                <canvas id="jobChart" style="width:700px; height:680px;"></canvas>

                <h4 class="fw-bold mb-4 mt-4">Attrition by Tenure</h4>
                <canvas id="tenureChart" style="width:700px; height:680px;"></canvas>

                <h4 class="fw-bold mb-4 mt-4">Attrition by Gender</h4>
                <canvas id="genderChart" style="width:700px; height:680px;"></canvas>

                <h4 class="fw-bold mb-4 mt-4">Attrition by OverTime</h4>
                <canvas id="overtimeChart" style="width:700px; height:680px;"></canvas>
            </div>
        </div>


        <!-- RISK TAB -->
        <div class="tab-pane fade" id="risk">
            <div class="tab-card">
                <h4 class="fw-bold">Risk Distribution</h4>
                <canvas id="riskBinsChart"></canvas>

                <h4 class="fw-bold mt-4">Risk Segmentation</h4>
                <canvas id="riskSegChart"></canvas>
            </div>
        </div>


        <!-- MODEL TAB -->
        <div class="tab-pane fade" id="models">
            <div class="tab-card">
                <h4 class="fw-bold">Model Comparison</h4>

                <table class="table table-bordered table-striped">
                    <thead>
                        <tr>
                            <th>Model</th>
                            <th>Accuracy (%)</th>
                            <th>F1 Score (%)</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for m in model_rows %}
                        <tr>
                            <td>{{ m.Model }}</td>
                            <td>{{ m.Accuracy }}</td>
                            <td>{{ m.F1_macro }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>

                <h5 class="fw-bold mt-4">Accuracy Comparison</h5>
                <canvas id="modelAccChart"></canvas>

                <h5 class="fw-bold mt-4">F1 Score Comparison</h5>
                <canvas id="modelF1Chart"></canvas>
            </div>
        </div>


        <!-- FEATURE IMPORTANCE TAB -->
        <div class="tab-pane fade" id="featureimportance">
            <div class="tab-card">
                <h4 class="fw-bold">Top Feature Importance</h4>
                <canvas id="fiChart"></canvas>
            </div>
        </div>


        <!-- SALARY TAB -->
        <div class="tab-pane fade" id="salary">
            <div class="tab-card">
                <h4 class="fw-bold">Salary vs Attrition</h4>
                <canvas id="salaryChart"></canvas>

                <h4 class="fw-bold mt-4">Department Health Score</h4>
                <canvas id="deptHealthChart"></canvas>
            </div>
        </div>


        <!-- FORECAST TAB -->
        <div class="tab-pane fade" id="forecast">
            <div class="tab-card">
                <h4 class="fw-bold">Attrition Forecast (Next 6 Months)</h4>
                <canvas id="forecastChart"></canvas>
            </div>
        </div>


        <!-- ================= INSIGHTS TAB ================= -->
        <div class="tab-pane fade" id="insights">
            <div class="tab-card">

                <h3 class="fw-bold mb-4">ðŸ§  Employee Insights</h3>

                <div class="row g-3">

                    <!-- KPI CARDS -->
                    <div class="col-md-4">
                        <div class="p-3 rounded shadow-sm" style="background:#ffe5e5;">
                            <h5>Low Job Satisfaction</h5>
                            <h2>{{ kpi_low_satisfaction }}</h2>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="p-3 rounded shadow-sm" style="background:#fff3cd;">
                            <h5>Poor Work-Life Balance</h5>
                            <h2>{{ kpi_poor_wlb }}</h2>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="p-3 rounded shadow-sm" style="background:#e0f7fa;">
                            <h5>Overtime Employees</h5>
                            <h2>{{ kpi_overtime }}</h2>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="p-3 rounded shadow-sm" style="background:#e8eaf6;">
                            <h5>No Promotion (5+ yrs)</h5>
                            <h2>{{ kpi_no_promo }}</h2>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="p-3 rounded shadow-sm" style="background:#e8f5e9;">
                            <h5>Low Salary Employees</h5>
                            <h2>{{ kpi_low_salary }}</h2>
                        </div>
                    </div>

                    <!-- Stability Bar Chart -->
                    <div class="col-md-12">
                        <canvas id="stabilityChart"></canvas>
                    </div>

                    <!-- AGE & INCOME -->
                    <div class="col-md-6">
                        <canvas id="ageChart"></canvas>
                    </div>

                    <div class="col-md-6">
                        <canvas id="incomeChart"></canvas>
                    </div>

                    <!-- Doughnut Charts -->
                    <div class="col-md-6">
                        <canvas id="eduChart"></canvas>
                    </div>

                    <div class="col-md-6">
                        <canvas id="joblevelChart"></canvas>
                    </div>

                    <!-- Department Ranking -->
                    <div class="col-md-12">
                        <canvas id="deptRankChart"></canvas>
                    </div>

                </div>
            </div>
        </div>

    </div>
</div>


<!-- JAVASCRIPT -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
    /* ========= OVERVIEW CHARTS (fixed size) ========= */

    new Chart(overallChart, {
        type: "pie",
        data: {
            labels: {{ overall_labels|tojson }},
            datasets: [{
                data: {{ overall_values|tojson }},
                backgroundColor:["#28a745","#dc3545"]
            }]
        },
        options: {
            responsive: false,
            maintainAspectRatio: false
        }
    });

    new Chart(deptChart, {
        type: "bar",
        data:{
            labels: {{ dept_labels|tojson }},
            datasets:[{
                data: {{ dept_values|tojson }},
                backgroundColor:"#0d6efd"
            }]
        },
        options: {
            responsive: false,
            maintainAspectRatio: false
        }
    });

    new Chart(jobChart, {
        type: "bar",
        data:{
            labels: {{ job_labels|tojson }},
            datasets:[{
                data: {{ job_values|tojson }},
                backgroundColor:"#6610f2"
            }]
        },
        options: {
            responsive: false,
            maintainAspectRatio: false
        }
    });

    new Chart(tenureChart, {
        type:"line",
        data:{
            labels: {{ tenure_labels|tojson }},
            datasets:[{
                data: {{ tenure_values|tojson }},
                borderColor:"#fd7e14",
                fill:false
            }]
        },
        options: {
            responsive: false,
            maintainAspectRatio: false
        }
    });

    new Chart(genderChart, {
        type:"bar",
        data:{
            labels: {{ gender_labels|tojson }},
            datasets:[{
                data: {{ gender_values|tojson }},
                backgroundColor:"#20c997"
            }]
        },
        options: {
            responsive: false,
            maintainAspectRatio: false
        }
    });

    new Chart(overtimeChart, {
        type:"bar",
        data:{
            labels: {{ overtime_labels|tojson }},
            datasets:[{
                data: {{ overtime_values|tojson }},
                backgroundColor:"#dc3545"
            }]
        },
        options: {
            responsive: false,
            maintainAspectRatio: false
        }
    });

    /* ========= OTHER TABS (can stay responsive) ========= */

    new Chart(riskBinsChart, {
        type:"bar",
        data:{
            labels: {{ risk_bins_labels|tojson }},
            datasets:[{
                data: {{ risk_bins_values|tojson }},
                backgroundColor:"#0d6efd"
            }]
        }
    });

    new Chart(riskSegChart, {
        type:"bar",
        data:{
            labels: {{ risk_seg_labels|tojson }},
            datasets:[{
                data: {{ risk_seg_values|tojson }},
                backgroundColor:["#28a745","#ffc107","#fd7e14","#dc3545"]
            }]
        }
    });

    new Chart(modelAccChart, {
        type:"bar",
        data:{
            labels: {{ model_names|tojson }},
            datasets:[{
                data: {{ model_acc_values|tojson }},
                backgroundColor:"#0d6efd"
            }]
        }
    });

    new Chart(modelF1Chart, {
        type:"bar",
        data:{
            labels: {{ model_names|tojson }},
            datasets:[{
                data: {{ model_f1_values|tojson }},
                backgroundColor:"#6610f2"
            }]
        }
    });

    new Chart(fiChart, {
        type:"bar",
        data:{
            labels: {{ fi_labels|tojson }},
            datasets:[{
                data: {{ fi_values|tojson }},
                backgroundColor:"#20c997"
            }]
        }
    });

    new Chart(salaryChart, {
        type:"scatter",
        data:{
            datasets:[
                { label:"Leave", data: {{ salary_leave_values|tojson }}, backgroundColor:"#dc3545" },
                { label:"Stay",  data: {{ salary_stay_values|tojson }},  backgroundColor:"#28a745" }
            ]
        }
    });

    new Chart(deptHealthChart, {
        type:"bar",
        data:{
            labels: {{ dept_health_labels|tojson }},
            datasets:[{
                data: {{ dept_health_values|tojson }},
                backgroundColor:"#0d6efd"
            }]
        }
    });

    new Chart(forecastChart, {
        type:"line",
        data:{
            labels: {{ forecast_labels|tojson }},
            datasets:[{
                label:"Forecast",
                data: {{ forecast_values|tojson }},
                borderColor:"#0d6efd",
                backgroundColor:"rgba(13,110,253,0.3)"
            }]
        }
    });

    // Stability Bar Chart
    new Chart(document.getElementById("stabilityChart"), {
        type: "bar",
        data: {
            labels: {{ stability_labels|tojson }},
            datasets: [{
                data: {{ stability_values|tojson }},
                backgroundColor: ["#ff9999","#ffe699","#99e6ff","#b3b3ff","#c6ffb3"]
            }]
        }
    });

    // Age Chart
    new Chart(ageChart, {
        type: "bar",
        data: {
            labels: {{ age_bins|tojson }},
            datasets: [{ data: {{ age_counts|tojson }}, backgroundColor:"#a29bfe" }]
        }
    });

    // Income Chart
    new Chart(incomeChart, {
        type: "bar",
        data: {
            labels: {{ income_bins|tojson }},
            datasets: [{ data: {{ income_counts|tojson }}, backgroundColor:"#ffb74d" }]
        }
    });

    // Education Doughnut
    new Chart(eduChart, {
        type: "doughnut",
        data: {
            labels: {{ edu_labels|tojson }},
            datasets: [{ data: {{ edu_values|tojson }} }]
        }
    });

    // Job Level Doughnut
    new Chart(joblevelChart, {
        type: "doughnut",
        data: {
            labels: {{ joblevel_labels|tojson }},
            datasets: [{ data: {{ joblevel_values|tojson }} }]
        }
    });

    // Dept Ranking
    new Chart(deptRankChart, {
        type: "bar",
        data: {
            labels: {{ dept_names|tojson }},
            datasets: [{ data: {{ dept_attrition|tojson }}, backgroundColor:"#ff6f61" }]
        }
    });
</script>

</body>
</html>
